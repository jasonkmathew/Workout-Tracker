<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Split Workout Tracker</title>
    <style>
        /* --- THEME & VARIABLES --- */
        :root {
            --bg: #0b0b0d;
            --card: #15161a;
            --text: #f5f5f7;
            --muted: #a1a1aa;
            --accent: #7c3aed;
            --accent-hover: #915dff;
            --danger: #e53e3e;
            --success: #34C759;
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.3);
            --accent-rgb: 124, 58, 237;
        }

        /* --- GLOBAL STYLES --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text);
            line-height: 1.5;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 10px;
        }

        /* --- AUTHENTICATION CONTAINER --- */
        .auth-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 40px;
            background: var(--card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 30px var(--shadow-color);
            text-align: center;
        }

        .auth-container h2 {
            margin-bottom: 25px;
            color: var(--text);
            font-size: 1.8rem;
        }

        .google-btn {
            background: transparent;
            color: var(--text);
            border: 1px solid var(--border-color);
            padding: 12px;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 0 auto 20px auto;
            width: 100%;
            transition: all 0.2s ease;
        }

        .google-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--accent);
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: var(--muted);
            font-size: 0.9rem;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border-color);
        }

        .divider::before { margin-right: 15px; }
        .divider::after { margin-left: 15px; }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .auth-form input {
            background: var(--bg);
            color: var(--text);
            padding: 14px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }

        .auth-form input:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* --- BUTTONS --- */
        .auth-btn, .add-set {
            background: var(--accent);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s ease;
        }

        .auth-btn:hover, .add-set:hover {
            background: var(--accent-hover);
        }
        
        .logout-btn, .remove-set {
            background: var(--danger);
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .logout-btn:hover, .remove-set:hover {
            background: #ff5252;
        }
        
        .logout-btn { padding: 8px 14px; border-radius: 8px; font-size: 0.85rem; }
        .remove-set { padding: 4px 8px; border-radius: 5px; font-size: 0.8rem; }
        .add-set { font-size: 0.85rem; padding: 8px 14px; margin-bottom: 10px; }

        .auth-switch {
            margin-top: 20px;
            color: var(--muted);
        }

        .auth-switch button {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            text-decoration: underline;
            font-size: 1em;
        }

        /* --- LOADING & ERRORS --- */
        .loading { text-align: center; padding: 50px; color: var(--muted); }
        .error { color: var(--danger); font-size: 0.9rem; margin-top: 15px; min-height: 1em; }

        /* --- MAIN APP UI --- */
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--card);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px var(--shadow-color);
            position: relative;
        }

        .header h1 {
            font-size: 1.6rem;
            color: var(--text);
            margin-bottom: 5px;
        }

        .header p { font-size: 0.9rem; color: var(--muted); }
        .user-info { font-size: 0.8rem; color: var(--muted); margin-top: 8px; }

        .logout-btn {
            position: absolute;
            top: 15px;
            right: 15px;
        }

        .controls {
            background: var(--card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .week-selector, .workout-selector { margin-bottom: 15px; }
        .week-selector:last-child, .workout-selector:last-child { margin-bottom: 0; }
        
        .week-selector label, .workout-selector label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .week-selector select, .workout-selector select, .exercise-select select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--bg);
            color: var(--text);
            cursor: pointer;
        }
        .week-selector select:focus, .workout-selector select:focus, .exercise-select select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .workout-content {
            background: var(--card);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 15px;
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .exercise {
            border-bottom: 1px solid var(--border-color);
            padding: 20px 0;
        }
        .exercise:last-child { border-bottom: none; }
        .exercise:first-child { padding-top: 5px; }

        .exercise-name { font-size: 1.2rem; font-weight: 600; margin-bottom: 5px; }
        .exercise-info { font-size: 0.85rem; color: var(--muted); margin-bottom: 15px; }
        .exercise-select { margin-bottom: 15px; }

        /* --- SETS GRID --- */
        .sets-grid {
            display: grid;
            grid-template-columns: 40px 1fr 1fr 60px;
            gap: 10px;
            align-items: center;
            margin-bottom: 8px;
        }

        .sets-grid label { font-size: 0.9rem; font-weight: 600; color: var(--muted); }

        .sets-grid input {
            padding: 10px 8px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.95rem;
            text-align: center;
            transition: all 0.2s ease;
            background: var(--bg);
            color: var(--text);
            width: 100%;
        }
        
        .sets-grid input:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--card);
        }

        .sets-grid input.previous-data {
            background: transparent;
            color: var(--muted);
            border-style: dashed;
        }

        .sets-grid input.current-data {
            border: 1px solid var(--accent);
            background: rgba(var(--accent-rgb), 0.1);
        }

        .previous-note {
            grid-column: 1 / -1;
            font-size: 0.75rem;
            color: var(--muted);
            font-style: italic;
            text-align: center;
            margin-top: -4px;
        }
        
        /* --- TIPS & NOTES --- */
        .exercise-tips, .tempo-key {
            padding: 12px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 3px solid var(--accent);
            background: rgba(var(--accent-rgb), 0.08);
        }

        .exercise-tips h4, .tempo-key h4 {
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: var(--accent-hover);
        }

        .exercise-tips p, .tempo-key p {
            font-size: 0.85rem;
            color: var(--muted);
            line-height: 1.4;
            margin: 2px 0;
        }
        
        .tempo-key p { color: var(--text); }
        .tempo-key p strong { font-weight: 600; color: var(--accent-hover); }

        .comments { margin-top: 15px; }
        .comments label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .comments textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 70px;
            background: var(--bg);
            color: var(--text);
        }
        .comments textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .rest-day { text-align: center; padding: 40px 20px; color: var(--muted); }
        .rest-day h2 { margin-bottom: 10px; font-size: 1.5rem; color: var(--text); }

        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 500;
            transform: translateY(-80px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .save-indicator.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 480px) {
            .container { padding: 5px; }
            .auth-container { padding: 25px; margin: 20px auto; }
            
            .sets-grid {
                grid-template-columns: 35px 1fr 1fr 50px;
                gap: 6px;
            }
            
            .sets-grid input { padding: 8px 6px; font-size: 0.9rem; }

            .logout-btn {
                position: static;
                margin-top: 15px;
                display: block;
                width: 100%;
            }

            .header, .controls, .workout-content { padding: 15px; }
        }
    </style>
</head>
<body>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC91rY8_FSfQfXkoFuhT0I_H_fan6VLNe0",
            authDomain: "split-workout-tracker.firebaseapp.com",
            projectId: "split-workout-tracker",
            storageBucket: "split-workout-tracker.firebasestorage.app",
            messagingSenderId: "429001339736",
            appId: "1:429001339736:web:e753739f5c827145c36b2d",
            measurementId: "G-1F6C2R60P7"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Global variables
        window.auth = auth;
        window.db = db;
        window.doc = doc;
        window.setDoc = setDoc;
        window.getDoc = getDoc;
        window.onSnapshot = onSnapshot;
        window.collection = collection;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.onAuthStateChanged = onAuthStateChanged;
        window.signOut = signOut;
        window.GoogleAuthProvider = GoogleAuthProvider;
        window.signInWithPopup = signInWithPopup;
    </script>

    <div id="authContainer" class="auth-container">
        <h2 id="authTitle">Welcome to Split Tracker</h2>
        
        <button type="button" class="google-btn" onclick="handleGoogleAuth()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22.56 12.25C22.56 11.47 22.49 10.72 22.36 10H12V14.26H18.19C17.93 15.63 17.17 16.78 16.05 17.59V20.36H19.59C21.66 18.44 22.56 15.63 22.56 12.25Z" fill="#4285F4"></path>
                <path d="M12 23C15.24 23 17.95 21.92 19.59 20.36L16.05 17.59C15.01 18.25 13.62 18.66 12 18.66C8.86 18.66 6.16 16.69 5.27 13.91H1.64V16.74C3.4 20.44 7.35 23 12 23Z" fill="#34A853"></path>
                <path d="M5.27 13.91C5.04 13.25 4.9 12.55 4.9 11.83C4.9 11.11 5.04 10.41 5.27 9.75V6.92H1.64C0.85 8.48 0.36 10.1 0.36 11.83C0.36 13.56 0.85 15.18 1.64 16.74L5.27 13.91Z" fill="#FBBC05"></path>
                <path d="M12 5C13.79 5 15.36 5.66 16.53 6.78L19.68 3.63C17.95 1.98 15.24 1 12 1C7.35 1 3.4 3.56 1.64 7.26L5.27 10.09C6.16 7.31 8.86 5 12 5Z" fill="#EA4335"></path>
            </svg>
            Continue with Google
        </button>
        
        <div class="divider">or</div>
        
        <form id="authForm" class="auth-form">
            <input type="email" id="email" placeholder="Email" required>
            <input type="password" id="password" placeholder="Password" required>
            <button type="submit" class="auth-btn" id="authBtn">Sign In</button>
            <div id="authError" class="error"></div>
        </form>
        <div class="auth-switch">
            <span id="authSwitchText">Don't have an account?</span>
            <button type="button" id="authSwitchBtn">Sign Up</button>
        </div>
    </div>

    <div id="loadingScreen" class="loading" style="display: none;">
        <h2>Loading your workouts...</h2>
    </div>

    <div id="appContainer" class="container" style="display: none;">
        <div class="header">
            <h1>ðŸ’ª Split Workout Tracker</h1>
            <p>2 on â€¢ 1 off â€¢ 2 on â€¢ 1-2 off</p>
            <div class="user-info" id="userInfo"></div>
            <button class="logout-btn" onclick="handleLogout()">Logout</button>
        </div>

        <div class="controls">
            <div class="week-selector">
                <label for="weekSelect">Week</label>
                <select id="weekSelect" onchange="selectWeek(this.value)">
                    <option value="1">Week 1</option>
                    <option value="2">Week 2</option>
                    <option value="3">Week 3</option>
                    <option value="4">Week 4</option>
                    <option value="5">Week 5</option>
                    <option value="6">Week 6</option>
                    <option value="7">Week 7</option>
                    <option value="8">Week 8</option>
                    <option value="9">Week 9</option>
                    <option value="10">Week 10</option>
                    <option value="11">Week 11</option>
                    <option value="12">Week 12</option>
                </select>
            </div>

            <div class="workout-selector">
                <label for="workoutSelect">Workout</label>
                <select id="workoutSelect" onchange="showWorkout(this.value)">
                    <option value="upperA">Upper A</option>
                    <option value="lowerA">Lower A</option>
                    <option value="rest1">Rest Day</option>
                    <option value="upperB">Upper B</option>
                    <option value="lowerB">Lower B</option>
                    <option value="rest2">Rest Day</option>
                </select>
            </div>
        </div>

        <div id="workoutContent" class="workout-content">
            </div>
    </div>

    <div id="saveIndicator" class="save-indicator">Saved âœ“</div>

    <script>
        let currentUser = null;
        let currentWeek = 1;
        let currentWorkout = 'upperA';
        let workoutData = {};
        let isSignUp = false;

        // Exercise execution tips and tempo explanations
        const exerciseTips = {
            "Incline Press": "Don't arch back, maintain stacked position. Brief pause at bottom. Stop 1-2\" above chest.",
            "Chest Fly": "Focus on expansion during eccentric. Don't force scapular retraction, focus on depression.",
            "Lat Pulldown": "Push elbows forward, think 'stabbing the floor'. Don't arch back. Pull DOWN, not back.",
            "Mid Back Row": "Stay upright, don't arch. Focus on shoulder extension, not retraction.",
            "Lateral Raise": "Think pushing out, not up/down. Keep arms slightly in front of you.",
            "Tricep Pushdown": "Control the eccentric, pause at stretch, squeeze at contraction.",
            "DB Curl": "Can rotate from neutral to supination through concentric for bicep focus.",
            "Leg Curl": "Lean forward from hips to lengthen hamstring. Sit back if reaching failure for more reps.",
            "Leg Extension": "Can lean back & scoot butt up for more rectus femoris activation.",
            "Squat": "Use heel elevation. Stay upright, drive knees forward. Brief pause at bottom.",
            "Adductors": "Set machine as wide as possible to force a stretch.",
            "Calf Raise": "Slightly bend knee on concentric. Hold 60sec loaded stretch after final set.",
            "Abs": "Focus on spinal flexion, not hip movement. Contract core through full range.",
            "Pullover": "Still a pulldown, not row. Stab floor with elbow, focus on scapular depression.",
            "Upper Back Row": "Keep elbows high/abducted. Initiate with shoulder extension into full retraction.",
            "Rear Delt Fly": "Start with full protraction. Think pushing outwards, don't turn into row.",
            "Shoulder Press": "Keep spine neutral, core engaged. Don't arch back or lift chest.",
            "Chest Press (RPS)": "Rest Pause: to failure, rest 20-30 breaths, repeat 3x total rounds.",
            "Lower Chest": "Drive biceps into chest, try to touch inner elbows at peak contraction.",
            "Preacher Curl": "Control eccentric, pause at stretch, hold peak contraction.",
            "Tricep Extension": "Focus on keeping upper arms still, control through full range.",
            "Lying Leg Curl": "Press hips into pad, keep spine neutral. Don't let pad leave contact.",
            "Leg Extension (RPS)": "Rest Pause: to failure, rest 20-30 breaths, repeat 3x total rounds.",
            "Romanian Deadlift": "Drive glutes back, knees over ankles. Think driving back then driving in.",
            "Lunges": "Control descent, brief pause, drive through front heel to return.",
            "Leg Raises": "Move into lumbar flexion to contract core, not just hip flexion."
        };

        const tempoKey = `
            <div class="tempo-key">
                <h4>Tempo Guide (e.g., 3:1:1:1)</h4>
                <p><strong>3</strong> = Eccentric (lowering) seconds</p>
                <p><strong>1</strong> = Pause at stretch/bottom position</p>
                <p><strong>1</strong> = Concentric (lifting) seconds</p>
                <p><strong>1</strong> = Pause at contraction/top</p>
            </div>
        `;

        // Workout definitions
        const workouts = {
            upperA: {
                name: "Upper A",
                exercises: [
                    {
                        name: "Incline Press",
                        sets: "1-2 sets",
                        reps: "6-10 reps",
                        tempo: "3:1:1:1",
                        options: ["Incline DB Press", "Incline Smith Machine", "Incline Barbell", "Incline Press Machine"]
                    },
                    {
                        name: "Chest Fly",
                        sets: "2-3 sets",
                        reps: "8-12 reps",
                        tempo: "3:1:1:1",
                        options: ["Chest Fly Machine", "Seated Cable Fly", "Flat DB Flys"]
                    },
                    {
                        name: "Lat Pulldown",
                        sets: "2-3 sets",
                        reps: "6-10 reps",
                        tempo: "3:1:1:1",
                        options: ["Wide Grip", "Neutral Grip", "Pulldown Machine"]
                    },
                    {
                        name: "Mid Back Row",
                        sets: "2-3 sets",
                        reps: "8-12 reps",
                        tempo: "3:1:1:1",
                        options: ["Seated Machine Row", "Cable Row"]
                    },
                    {
                        name: "Lateral Raise",
                        sets: "2-4 sets",
                        reps: "10-15 reps",
                        tempo: "4:1:1:1",
                        options: ["DB Lateral Raise", "Lateral Raise Machine", "Cable Lateral Raise"]
                    },
                    {
                        name: "Tricep Pushdown",
                        sets: "2-4 sets",
                        reps: "8-12 reps",
                        tempo: "3:2:1:1",
                        options: ["Rope", "V-Bar", "Straight Bar"]
                    },
                    {
                        name: "DB Curl",
                        sets: "2-4 sets",
                        reps: "8-12 reps",
                        tempo: "3:1:1:1",
                        options: ["Alternating DB Curl", "Hammer Curl", "Seated", "Standing"]
                    }
                ]
            },
            lowerA: {
                name: "Lower A",
                exercises: [
                    {
                        name: "Leg Curl",
                        sets: "2-3 sets",
                        reps: "8-12 reps",
                        tempo: "4:1:1:1",
                        options: ["Seated Leg Curl"]
                    },
                    {
                        name: "Leg Extension",
                        sets: "2-3 sets",
                        reps: "8-12 reps",
                        tempo: "3:1:1:1",
                        options: ["Standard", "Leaning Back"]
                    },
                    {
                        name: "Squat",
                        sets: "1-2 sets",
                        reps: "6-10 reps",
                        tempo: "3:1:1:1",
                        options: ["High Bar Back Squat", "Front Squat", "Smith Machine", "Hack Squat"]
                    },
                    {
                        name: "Adductors",
                        sets: "2-3 sets",
                        reps: "10-15 reps",
                        tempo: "3:2:1:1",
                        options: ["Adductor Machine"]
                    },
                    {
                        name: "Calf Raise",
                        sets: "3-5 sets",
                        reps: "10-15 reps",
                        tempo: "3:2:1:2",
                        options: ["Standing Machine", "Donkey", "Leg Press"]
                    },
                    {
                        name: "Abs",
                        sets: "3-5 sets",
                        reps: "10-15 reps",
                        tempo: "3:1:1:1",
                        options: ["Crunch Machine", "Cable Crunches"]
                    }
                ]
            },
            upperB: {
                name: "Upper B",
                exercises: [
                    {
                        name: "Pullover",
                        sets: "2-3 sets",
                        reps: "8-12 reps",
                        tempo: "3:1:1:1",
                        options: ["Cable Pullover", "Machine Pulldown"]
                    },
                    {
                        name: "Upper Back Row",
                        sets: "2-3 sets",
                        reps: "6-10 reps",
                        tempo: "3:1:1:2",
                        options: ["T-Bar Row", "Machine Row", "DB Row"]
                    },
                    {
                        name: "Rear Delt Fly",
                        sets: "2-4 sets",
                        reps: "10-15 reps",
                        tempo: "3:2:1:2",
                        options: ["Machine", "Cable", "DB Fly"]
                    },
                    {
                        name: "Shoulder Press",
                        sets: "1-2 sets",
                        reps: "8-12 reps",
                        tempo: "3:1:1:1",
                        options: ["DB Press", "Smith Machine", "Machine Press"]
                    },
                    {
                        name: "Chest Press (RPS)",
                        sets: "Rest Pause",
                        reps: "10-12 reps",
                        tempo: "3:1:1:1",
                        options: ["Machine Press", "Smith Bench"]
                    },
                    {
                        name: "Lower Chest",
                        sets: "2-3 sets",
                        reps: "10-15 reps",
                        tempo: "3:1:1:1",
                        options: ["Decline Cable", "Cable Fly"]
                    },
                    {
                        name: "Preacher Curl",
                        sets: "2-4 sets",
                        reps: "8-12 reps",
                        tempo: "3:2:1:2",
                        options: ["DB", "Cable", "Machine", "Barbell"]
                    },
                    {
                        name: "Tricep Extension",
                        sets: "2-4 sets",
                        reps: "8-12 reps",
                        tempo: "3:2:1:1",
                        options: ["Skull Crushers", "JM Press"]
                    }
                ]
            },
            lowerB: {
                name: "Lower B",
                exercises: [
                    {
                        name: "Lying Leg Curl",
                        sets: "2-3 sets",
                        reps: "8-12 reps",
                        tempo: "4:2:1:2",
                        options: ["Lying Leg Curl"]
                    },
                    {
                        name: "Leg Extension (RPS)",
                        sets: "Rest Pause",
                        reps: "12-15 reps",
                        tempo: "3:1:1:2",
                        options: ["Standard", "Leaning Back"]
                    },
                    {
                        name: "Romanian Deadlift",
                        sets: "2 sets",
                        reps: "8-12 reps",
                        tempo: "4:1:1:1",
                        options: ["Dumbbells", "Barbell", "Belt Squat"]
                    },
                    {
                        name: "Lunges",
                        sets: "2 sets",
                        reps: "8-12 reps/leg",
                        tempo: "3:1:1:1",
                        options: ["Walking DB", "Split Squat", "Bulgarian", "Leg Press"]
                    },
                    {
                        name: "Calf Raise",
                        sets: "3-5 sets",
                        reps: "8-12 reps",
                        tempo: "3:2:1:2",
                        options: ["Standing Machine", "Donkey", "Leg Press"]
                    },
                    {
                        name: "Leg Raises",
                        sets: "3-5 sets",
                        reps: "AMRAP",
                        tempo: "3:1:1:1",
                        options: ["Hanging", "Machine", "Lying"]
                    }
                ]
            }
        };

        // Authentication functions
        function initAuth() {
            const authForm = document.getElementById('authForm');
            const authSwitchBtn = document.getElementById('authSwitchBtn');

            authForm.addEventListener('submit', handleAuth);
            authSwitchBtn.addEventListener('click', toggleAuthMode);

            // Listen for auth state changes
            window.onAuthStateChanged(window.auth, (user) => {
                if (user) {
                    currentUser = user;
                    showApp();
                    loadUserData();
                } else {
                    currentUser = null;
                    showAuth();
                }
            });
        }

        async function handleGoogleAuth() {
            const errorDiv = document.getElementById('authError');
            
            try {
                const provider = new window.GoogleAuthProvider();
                await window.signInWithPopup(window.auth, provider);
            } catch (error) {
                console.error('Google auth error:', error);
                errorDiv.textContent = error.message;
            }
        }

        function toggleAuthMode() {
            isSignUp = !isSignUp;
            const authTitle = document.getElementById('authTitle');
            const authBtn = document.getElementById('authBtn');
            const authSwitchText = document.getElementById('authSwitchText');
            const authSwitchBtn = document.getElementById('authSwitchBtn');

            if (isSignUp) {
                authTitle.textContent = 'Create Account';
                authBtn.textContent = 'Sign Up';
                authSwitchText.textContent = 'Already have an account?';
                authSwitchBtn.textContent = 'Sign In';
            } else {
                authTitle.textContent = 'Welcome Back';
                authBtn.textContent = 'Sign In';
                authSwitchText.textContent = "Don't have an account?";
                authSwitchBtn.textContent = 'Sign Up';
            }
        }

        async function handleAuth(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('authError');

            try {
                if (isSignUp) {
                    await window.createUserWithEmailAndPassword(window.auth, email, password);
                } else {
                    await window.signInWithEmailAndPassword(window.auth, email, password);
                }
            } catch (error) {
                errorDiv.textContent = error.message;
            }
        }

        async function handleLogout() {
            try {
                await window.signOut(window.auth);
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        function showAuth() {
            document.getElementById('authContainer').style.display = 'block';
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'none';
        }

        function showApp() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            document.getElementById('userInfo').textContent = `Logged in as: ${currentUser.email}`;
        }

        function showLoading() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('loadingScreen').style.display = 'block';
            document.getElementById('appContainer').style.display = 'none';
        }

        // Data functions
        function initializeWorkoutData() {
            workoutData = {};
            for (let week = 1; week <= 12; week++) {
                workoutData[week] = {};
                for (let workoutKey in workouts) {
                    workoutData[week][workoutKey] = {};
                    workouts[workoutKey].exercises.forEach((exercise, index) => {
                        workoutData[week][workoutKey][index] = {
                            selectedExercise: exercise.options[0],
                            sets: [{ weight: '', reps: '' }, { weight: '', reps: '' }],
                            comments: ''
                        };
                    });
                }
            }
        }

        async function loadUserData() {
            if (!currentUser) return;
            
            showLoading();
            
            try {
                const userDocRef = window.doc(window.db, 'users', currentUser.uid);
                const userDoc = await window.getDoc(userDocRef);
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    if (userData.workouts) {
                        workoutData = userData.workouts;
                    } else {
                        initializeWorkoutData();
                    }
                } else {
                    initializeWorkoutData();
                    await saveUserData();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                initializeWorkoutData();
            }
            
            showApp();
            showWorkout(currentWorkout);
        }

        async function saveUserData() {
            if (!currentUser) return;
            
            try {
                const userDocRef = window.doc(window.db, 'users', currentUser.uid);
                await window.setDoc(userDocRef, {
                    workouts: workoutData,
                    lastUpdated: new Date()
                }, { merge: true });
                
                showSaveIndicator();
            } catch (error) {
                console.error('Error saving user data:', error);
            }
        }

        // App functions
        function selectWeek(week) {
            currentWeek = parseInt(week);
            showWorkout(currentWorkout);
        }

        function showWorkout(workoutKey) {
            currentWorkout = workoutKey;
            document.getElementById('workoutSelect').value = workoutKey;

            const content = document.getElementById('workoutContent');
            
            if (workoutKey === 'rest1' || workoutKey === 'rest2') {
                content.innerHTML = `
                    <div class="rest-day">
                        <h2>ðŸ›Œ Rest Day</h2>
                        <p>Recovery time - prepare for your next workout!</p>
                    </div>
                `;
                return;
            }

            const workout = workouts[workoutKey];
            let html = tempoKey;
            
            workout.exercises.forEach((exercise, index) => {
                const exerciseData = workoutData[currentWeek][workoutKey][index];
                const previousWeekData = currentWeek > 1 ? workoutData[currentWeek - 1][workoutKey][index] : null;
                const tips = exerciseTips[exercise.name] || "Focus on proper form and controlled movement.";
                
                html += `
                    <div class="exercise">
                        <div class="exercise-name">${exercise.name}</div>
                        <div class="exercise-info">${exercise.sets} â€¢ ${exercise.reps} â€¢ ${exercise.tempo}</div>
                        
                        <div class="exercise-select">
                            <select onchange="updateExerciseSelection(${index}, this.value)">
                                ${exercise.options.map(option => `
                                    <option value="${option}" ${exerciseData.selectedExercise === option ? 'selected' : ''}>
                                        ${option}
                                    </option>
                                `).join('')}
                            </select>
                        </div>
                        
                        <div id="sets-${index}">
                            ${generateSetsHTML(index, exerciseData, previousWeekData)}
                        </div>
                        
                        <button class="add-set" onclick="addSet(${index})">+ Add Set</button>
                        
                        <div class="exercise-tips">
                            <h4>Execution Tips:</h4>
                            <p>${tips}</p>
                        </div>
                        
                        <div class="comments">
                            <label>Notes</label>
                            <textarea 
                                placeholder="Form notes, improvements, etc..."
                                onchange="updateComments(${index}, this.value)"
                            >${exerciseData.comments}</textarea>
                        </div>
                    </div>
                `;
            });

            content.innerHTML = html;
        }

        function generateSetsHTML(exerciseIndex, exerciseData, previousWeekData) {
            let html = '';
            
            // Determine how many sets to show (current data or previous data, whichever is more)
            const currentSets = exerciseData.sets.length;
            const previousSets = previousWeekData ? previousWeekData.sets.length : 0;
            const maxSets = Math.max(currentSets, previousSets, 2); // Minimum 2 sets
            
            // Ensure we have enough sets in current data
            while (exerciseData.sets.length < maxSets) {
                exerciseData.sets.push({ weight: '', reps: '' });
            }
            
            for (let setIndex = 0; setIndex < maxSets; setIndex++) {
                const currentSet = exerciseData.sets[setIndex] || { weight: '', reps: '' };
                const previousSet = previousWeekData && previousWeekData.sets[setIndex] ? previousWeekData.sets[setIndex] : null;
                
                // Use previous week's data as placeholder if current is empty
                const weightValue = currentSet.weight !== '' ? currentSet.weight : 
                                  (previousSet && currentWeek > 1 ? previousSet.weight : '');
                const repsValue = currentSet.reps !== '' ? currentSet.reps : 
                                (previousSet && currentWeek > 1 ? previousSet.reps : '');
                
                // Determine input styling based on data source
                const hasCurrentData = currentSet.weight !== '' || currentSet.reps !== '';
                const hasPreviousData = previousSet && (previousSet.weight || previousSet.reps) && currentWeek > 1;
                
                let weightClass = '';
                let repsClass = '';
                let weightPlaceholder = 'Weight';
                let repsPlaceholder = 'Reps';
                
                if (hasCurrentData) {
                    weightClass = 'current-data';
                    repsClass = 'current-data';
                } else if (hasPreviousData && !hasCurrentData) {
                    weightClass = 'previous-data';
                    repsClass = 'previous-data';
                    weightPlaceholder = `Last: ${previousSet.weight || '?'}`;
                    repsPlaceholder = `Last: ${previousSet.reps || '?'}`;
                }
                
                html += `
                    <div class="sets-grid">
                        <label>S${setIndex + 1}</label>
                        <input type="number" 
                               placeholder="${weightPlaceholder}" 
                               value="${weightValue}" 
                               class="${weightClass}"
                               onchange="updateSetData(${exerciseIndex}, ${setIndex}, 'weight', this.value)"
                               onfocus="this.classList.remove('previous-data'); this.classList.add('current-data');">
                        <input type="number" 
                               placeholder="${repsPlaceholder}" 
                               value="${repsValue}"
                               class="${repsClass}"
                               onchange="updateSetData(${exerciseIndex}, ${setIndex}, 'reps', this.value)"
                               onfocus="this.classList.remove('previous-data'); this.classList.add('current-data');">
                        ${setIndex > 1 ? `<button class="remove-set" onclick="removeSet(${exerciseIndex}, ${setIndex})">Ã—</button>` : '<span></span>'}
                        ${hasPreviousData && !hasCurrentData ? 
                            `<div class="previous-note">Previous week data - click to edit</div>` : ''
                        }
                    </div>
                `;
            }
            
            return html;
        }

        function updateExerciseSelection(exerciseIndex, value) {
            workoutData[currentWeek][currentWorkout][exerciseIndex].selectedExercise = value;
            saveUserData();
        }

        function updateSetData(exerciseIndex, setIndex, field, value) {
            const exerciseData = workoutData[currentWeek][currentWorkout][exerciseIndex];
            if (!exerciseData.sets[setIndex]) {
                exerciseData.sets[setIndex] = { weight: '', reps: '' };
            }
            exerciseData.sets[setIndex][field] = value;
            
            // Update the input styling to show it's now current data
            const input = event.target;
            input.classList.remove('previous-data');
            input.classList.add('current-data');
            
            saveUserData();
        }

        function updateComments(exerciseIndex, value) {
            workoutData[currentWeek][currentWorkout][exerciseIndex].comments = value;
            saveUserData();
        }

        function addSet(exerciseIndex) {
            const exerciseData = workoutData[currentWeek][currentWorkout][exerciseIndex];
            exerciseData.sets.push({ weight: '', reps: '' });
            
            const previousWeekData = currentWeek > 1 ? workoutData[currentWeek - 1][currentWorkout][exerciseIndex] : null;
            document.getElementById(`sets-${exerciseIndex}`).innerHTML = generateSetsHTML(exerciseIndex, exerciseData, previousWeekData);
            saveUserData();
        }

        function removeSet(exerciseIndex, setIndex) {
            const exerciseData = workoutData[currentWeek][currentWorkout][exerciseIndex];
            exerciseData.sets.splice(setIndex, 1);
            
            const previousWeekData = currentWeek > 1 ? workoutData[currentWeek - 1][currentWorkout][exerciseIndex] : null;
            document.getElementById(`sets-${exerciseIndex}`).innerHTML = generateSetsHTML(exerciseIndex, exerciseData, previousWeekData);
            saveUserData();
        }

        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        // Initialize the app when page loads
        window.addEventListener('load', () => {
            initAuth();
        });
    </script>
</body>
</html>